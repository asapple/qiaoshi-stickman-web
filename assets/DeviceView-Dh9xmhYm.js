import{d as N,r as m,o as z,c as f,a,b as n,w as l,u as s,N as B,P as F,T as S,s as k,e as r,f as j,I as _,g as x,F as A,h as $,L,i,B as h,j as D,k as b,l as G,m as O,n as U,p,q,t as R,_ as E}from"./index-D8wFoKkw.js";import{G as J,a as M}from"./index-D4yzZMJd.js";const H={class:"device-page"},K={class:"content"},Q={class:"device-card"},W={class:"device-name"},X={key:0,class:"loading-placeholder"},Y={key:1,class:"empty-placeholder"},Z={class:"add-device-popup"},ee={class:"popup-content"},oe={class:"popup-footer"},se=N({__name:"DeviceView",setup(ae){const T=O();U();const w=m([]),v=m(!1),c=m(!1),t=m({deviceId:"",devicePassword:""}),y=()=>localStorage.getItem("authToken")||"",g=async()=>{v.value=!0,k("加载中...");try{const d=y(),o=await(await fetch("http://121.40.120.244:8080/stickman/box/list_all_boxes_of_user",{method:"POST",headers:{Authorization:d,"Content-Type":"application/json"}})).json();o.code===200?(console.log(o.data),w.value=o.data.map(u=>({boxId:u.id,deviceId:u.boxDeviceId,name:u.boxName||`设备 ${u.boxDeviceId}`}))):r(o.message||"获取设备列表失败")}catch(d){r("网络错误"),console.error("Failed to fetch devices:",d)}finally{v.value=!1,j()}},C=(d,e)=>{T.push({path:`/device/${d}`,query:{deviceId:d,boxId:e}})},I=()=>{c.value=!0},P=async()=>{if(!t.value.deviceId){r("请输入设备ID");return}if(!t.value.devicePassword){r("请输入设备密码");return}try{k("绑定中...");const d=y(),o=await(await fetch("http://121.40.120.244:8080/stickman/user/box/add",{method:"POST",headers:{Authorization:d,"Content-Type":"application/json"},body:JSON.stringify({boxDeviceId:t.value.deviceId,password:t.value.devicePassword})})).json();o.code===200?(G("设备绑定成功"),t.value.deviceId="",t.value.devicePassword="",c.value=!1,await g()):r(o.message||"绑定失败")}catch(d){r("网络错误，请稍后重试"),console.error("Failed to add device:",d)}},V=()=>{t.value.deviceId="",t.value.devicePassword="",c.value=!1};return z(()=>{g()}),(d,e)=>(p(),f("div",H,[a(s(B),{title:"设备管理"},{right:l(()=>[a(s(_),{name:"replay",size:"20",onClick:g,style:{"margin-right":"15px"}}),a(s(_),{name:"plus",size:"20",onClick:I})]),_:1}),n("div",K,[a(s(J),{"column-num":2,border:!1,gutter:"10"},{default:l(()=>[(p(!0),f(A,null,$(w.value,o=>(p(),q(s(M),{key:o.boxId,onClick:u=>C(o.deviceId,o.boxId)},{default:l(()=>[n("div",Q,[a(s(_),{name:"graphic",size:"32"}),n("div",W,R(o.name),1)])]),_:2},1032,["onClick"]))),128)),v.value?(p(),f("div",X,[a(s(L),{size:"24px"},{default:l(()=>e[3]||(e[3]=[i("加载中...",-1)])),_:1,__:[3]})])):x("",!0),!v.value&&w.value.length===0?(p(),f("div",Y,[a(s(_),{name:"info-o",size:"48"}),e[5]||(e[5]=n("p",null,"暂无设备",-1)),a(s(h),{round:"",onClick:I},{default:l(()=>e[4]||(e[4]=[i("添加设备",-1)])),_:1,__:[4]})])):x("",!0)]),_:1})]),a(s(F),{show:c.value,"onUpdate:show":e[2]||(e[2]=o=>c.value=o),position:"bottom",style:{height:"40%"},round:""},{default:l(()=>[n("div",Z,[e[8]||(e[8]=n("div",{class:"popup-header"},[n("h2",null,"添加新设备")],-1)),n("div",ee,[a(s(D),{modelValue:t.value.deviceId,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.deviceId=o),label:"设备ID",placeholder:"请输入设备ID",clearable:""},null,8,["modelValue"]),a(s(D),{modelValue:t.value.devicePassword,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.devicePassword=o),type:"password",label:"设备密码",placeholder:"请输入设备密码",clearable:""},null,8,["modelValue"])]),n("div",oe,[a(s(h),{block:"",round:"",onClick:V,style:{margin:"0 10px 10px 10px"}},{default:l(()=>e[6]||(e[6]=[i(" 取消 ",-1)])),_:1,__:[6]}),a(s(h),{type:"primary",block:"",round:"",onClick:P,style:{margin:"0 10px 10px 10px"}},{default:l(()=>e[7]||(e[7]=[i(" 确认 ",-1)])),_:1,__:[7]})])])]),_:1},8,["show"]),a(s(S),{route:""},{default:l(()=>[a(s(b),{replace:"",to:"/device",icon:"apps-o"},{default:l(()=>e[9]||(e[9]=[i("设备",-1)])),_:1,__:[9]}),a(s(b),{replace:"",to:"/contacts",icon:"contact-o"},{default:l(()=>e[10]||(e[10]=[i("通知人",-1)])),_:1,__:[10]}),a(s(b),{replace:"",to:"/profile",icon:"user-o"},{default:l(()=>e[11]||(e[11]=[i("我的",-1)])),_:1,__:[11]})]),_:1})]))}}),de=E(se,[["__scopeId","data-v-3b16aabc"]]);export{de as default};
