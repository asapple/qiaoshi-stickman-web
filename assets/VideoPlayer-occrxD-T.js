import{d as N,r as a,K as I,o as $,aa as K,c as f,ab as G,b as n,g as v,t as q,p as m,_ as Q}from"./index-6nRFhmNz.js";const X={class:"buttons-box",id:"buttonsBox"},Y={class:"buttons-box-left"},Z={class:"buttons-box-right"},ee={class:"bandwidth"},te=2,oe=N({__name:"VideoPlayer",props:{videoUrl:{type:String,default:""},height:{type:String,default:"400px"},aspectRatio:{type:String,default:"16:9"},hasAudio:{type:Boolean,default:!0},error:{type:String,default:""}},emits:["play","pause","error","fullscreen"],setup(D,{emit:F}){const g=D,c=F,u=a(),p=a(!1),b=a(!0),w=a(!1),J=a(!1),A=a(0),H=a(""),O=a(g.height),y=a(!1),r=a(!1),i=a(null);let t=null;const _=async e=>{if(!e)return!1;try{console.log("å¼€å§‹é¢„çƒ­è¿žæŽ¥åˆ°:",e),y.value=!0;const o=new AbortController,l=setTimeout(()=>o.abort(),1e4);try{const s=await fetch(e,{method:"GET",mode:"cors",cache:"no-cache",headers:{Range:"bytes=0-4096"},signal:o.signal});if(clearTimeout(l),s.ok||s.status===206){if(s.body){const h=s.body.getReader(),R=await h.read();await h.cancel()}return console.log("è¿žæŽ¥é¢„çƒ­æˆåŠŸï¼ŒçŠ¶æ€ç :",s.status),y.value=!1,!0}}catch(s){if(clearTimeout(l),s.name==="AbortError")return console.warn("è¿žæŽ¥é¢„çƒ­è¶…æ—¶"),y.value=!1,!0;console.warn("Rangeè¯·æ±‚å¤±è´¥ï¼Œå°è¯•HEADè¯·æ±‚:",s.message);const h=new AbortController,R=setTimeout(()=>h.abort(),1e4);try{const T=await fetch(e,{method:"HEAD",mode:"cors",cache:"no-cache",signal:h.signal});return clearTimeout(R),console.log("HEADè¯·æ±‚é¢„çƒ­æˆåŠŸï¼ŒçŠ¶æ€ç :",T.status),y.value=!1,!0}catch(T){clearTimeout(R),T.name==="AbortError"?console.warn("HEADè¯·æ±‚è¶…æ—¶"):console.warn("HEADè¯·æ±‚ä¹Ÿå¤±è´¥:",T.message)}}return console.warn("è¿žæŽ¥é¢„çƒ­å¤±è´¥ï¼Œä½†å°†ç»§ç»­å°è¯•æ’­æ”¾"),y.value=!1,!0}catch(o){return console.warn("è¿žæŽ¥é¢„çƒ­è¿‡ç¨‹å‡ºé”™:",o.message),y.value=!1,!0}},k=()=>{if(!u.value)return;const e=u.value;let l=e.parentElement?.clientWidth||0,s=9/16*l;s>e.clientHeight&&(s=e.clientHeight,l=16/9*s),l>0&&s>0&&(e.style.width=l+"px",e.style.height=s+"px",e.style.paddingTop="0")},z=()=>{if(!u.value)return;const e={container:u.value,autoWasm:!0,background:"",controlAutoHide:!1,debug:!1,decoder:"/jessibuca/decoder.js",forceNoOffscreen:!1,hasAudio:g.hasAudio,heartTimeout:15,heartTimeoutReplay:!0,heartTimeoutReplayTimes:5,hiddenAutoPause:!1,hotKey:!0,isFlv:!1,isFullResize:!1,isNotMute:b.value,isResize:!1,keepScreenOn:!0,loadingText:"è§†é¢‘åŠ è½½ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...",loadingTimeout:30,loadingTimeoutReplay:!0,loadingTimeoutReplayTimes:5,openWebglAlignment:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1,record:!1},recordType:"mp4",rotate:0,showBandwidth:!1,supportDblclickFullscreen:!1,timeout:30,useMSE:!0,useWCS:!1,useWebFullScreen:!0,videoBuffer:.5,wasmDecodeErrorReplay:!0,wcsUseVideoRender:!0};console.log("Jessibuca -> options: ",e),typeof window<"u"&&window.Jessibuca?(t=new window.Jessibuca(e),M()):console.error("Jessibuca not available")};let d=0,E="";const M=()=>{t&&(t.on("pause",()=>{p.value=!1,r.value=!1,c("pause")}),t.on("play",()=>{p.value=!0,r.value=!0,J.value=!0,d=0,c("play")}),t.on("fullscreen",e=>{w.value=e,c("fullscreen",e)}),t.on("mute",e=>{b.value=!e}),t.on("performance",e=>{let o="å¡é¡¿";e===2?o="éžå¸¸æµç•…":e===1&&(o="æµç•…"),H.value=o}),t.on("kBps",e=>{A.value=Math.round(e)}),t.on("error",async e=>{console.log("Jessibuca -> error: ",e);const o=e.toLowerCase();if((e.indexOf("CERT")!==-1||o.indexOf("certificate")!==-1||e.indexOf("ERR_CERT")!==-1||o.indexOf("fetcherror")!==-1||o.indexOf("common_name")!==-1||o.indexOf("common name")!==-1)&&d<te&&E){if(d++,console.log(`æ£€æµ‹åˆ°è¯ä¹¦/è¿žæŽ¥é”™è¯¯ï¼Œè¿›è¡Œç¬¬${d}æ¬¡é‡è¯•...`),await _(E),await new Promise(s=>setTimeout(s,1500)),t)try{t.play(E)}catch(s){console.error("é‡è¯•æ’­æ”¾å¤±è´¥:",s),d=0,c("error",e)}}else d=0,c("error",e)}),t.on("timeout",e=>{console.log("Jessibuca -> timeout: ",e)}),t.on("loadingTimeout",e=>{console.log("Jessibuca -> loadingTimeout: ",e)}))},P=async()=>{await B(g.videoUrl)},B=async e=>{if(console.log("Jessibuca -> url: ",e),!e){console.log("è§†é¢‘URLä¸ºç©ºï¼Œè·³è¿‡æ’­æ”¾");return}if(i.value)try{await i.value}catch{console.log("ä¹‹å‰çš„æ’­æ”¾è¢«ä¸­æ–­")}if(r.value&&t)try{t.pause(),await new Promise(o=>setTimeout(o,100))}catch(o){console.log("æš‚åœæ—¶å‡ºé”™:",o)}E=e,d=0,console.log("å¼€å§‹è¿žæŽ¥é¢„çƒ­..."),await _(e),await new Promise(o=>setTimeout(o,500)),t&&S(),z(),t&&setTimeout(async()=>{if(t&&t.hasLoaded()){console.log("æ’­æ”¾å™¨å·²åŠ è½½ï¼Œå¼€å§‹æ’­æ”¾");try{i.value=Promise.resolve(t.play(e)),await i.value,r.value=!0}catch(o){o.name!=="AbortError"&&(console.error("æ’­æ”¾å¤±è´¥:",o),c("error",o.message||"æ’­æ”¾å¤±è´¥"))}finally{i.value=null}}else t&&t.on("load",async()=>{console.log("æ’­æ”¾å™¨åŠ è½½å®Œæˆï¼Œå¼€å§‹æ’­æ”¾");try{i.value=Promise.resolve(t.play(e)),await i.value,r.value=!0}catch(o){o.name!=="AbortError"&&(console.error("æ’­æ”¾å¤±è´¥:",o),c("error",o.message||"æ’­æ”¾å¤±è´¥"))}finally{i.value=null}})},1500)},V=()=>{if(t&&r.value)try{t.pause(),r.value=!1}catch(e){e.name!=="AbortError"&&console.error("æš‚åœå¤±è´¥:",e),r.value=!1}p.value=!1},S=()=>{t&&t.destroy();const e=document.getElementById("buttonsBox");e&&u.value&&u.value.appendChild(e),t=null,p.value=!1},W=()=>{t&&t.screenshot()},j=()=>{t&&t.mute()},L=()=>{t&&t.cancelMute()},C=()=>{const e=U();t&&t.setFullscreen(!e),w.value=!e},U=()=>!!(document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement);let x=null;return I(()=>g.videoUrl,async e=>{x&&clearTimeout(x),e&&(x=setTimeout(async()=>{await B(e)},3e3))},{immediate:!0}),$(()=>{if(k(),window.addEventListener("resize",k),typeof window<"u"&&!window.Jessibuca){const e=document.createElement("script");e.src="/jessibuca/jessibuca.js",e.onload=()=>{console.log("Jessibuca loaded successfully")},document.head.appendChild(e)}}),K(()=>{t&&t.destroy(),window.removeEventListener("resize",k)}),(e,o)=>(m(),f("div",{class:"video-player-container",style:G({height:O.value})},[n("div",{ref_key:"container",ref:u,onDblclick:C,style:{width:"100%",height:"100%","background-color":"#000000",margin:"0 auto",position:"relative"}},[o[2]||(o[2]=n("div",{style:{width:"100%","padding-top":"56.25%",position:"relative"}},null,-1)),n("div",X,[n("div",Y,[p.value?v("",!0):(m(),f("i",{key:0,class:"play-btn",onClick:P},"â–¶")),p.value?(m(),f("i",{key:1,class:"pause-btn",onClick:V},"â¸")):v("",!0),n("i",{class:"stop-btn",onClick:S},"â¹"),b.value?(m(),f("i",{key:2,class:"audio-btn",onClick:o[0]||(o[0]=l=>j())},"ðŸ”Š")):v("",!0),b.value?v("",!0):(m(),f("i",{key:3,class:"mute-btn",onClick:o[1]||(o[1]=l=>L())},"ðŸ”‡"))]),n("div",Z,[n("span",ee,q(A.value)+" kb/s",1),n("i",{class:"screenshot-btn",onClick:W},"ðŸ“·"),n("i",{class:"refresh-btn",onClick:P},"ðŸ”„"),w.value?v("",!0):(m(),f("i",{key:0,class:"fullscreen-btn",onClick:C},"â›¶")),w.value?(m(),f("i",{key:1,class:"exit-fullscreen-btn",onClick:C},"â›¶")):v("",!0)])])],544)],4))}}),ae=Q(oe,[["__scopeId","data-v-f1d01813"]]);export{ae as V};
