import{d as j,r as a,K as L,o as U,aa as N,c,ab as I,b as l,g as m,t as $,p as u,_ as K}from"./index-0YGLxGz1.js";const G={class:"buttons-box",id:"buttonsBox"},q={class:"buttons-box-left"},Q={class:"buttons-box-right"},X={class:"bandwidth"},Y=2,Z=j({__name:"VideoPlayer",props:{videoUrl:{type:String,default:""},height:{type:String,default:"400px"},aspectRatio:{type:String,default:"16:9"},hasAudio:{type:Boolean,default:!0},error:{type:String,default:""}},emits:["play","pause","error","fullscreen"],setup(B,{emit:S}){const h=B,p=S,r=a(),d=a(!1),b=a(!0),g=a(!1),D=a(!1),C=a(0),F=a(""),J=a(h.height),f=a(!1);let t=null;const x=async e=>{if(!e)return!1;try{console.log("å¼€å§‹é¢„çƒ­è¿žæŽ¥åˆ°:",e),f.value=!0;const o=new AbortController,n=setTimeout(()=>o.abort(),1e4);try{const s=await fetch(e,{method:"GET",mode:"cors",cache:"no-cache",headers:{Range:"bytes=0-4096"},signal:o.signal});if(clearTimeout(n),s.ok||s.status===206){if(s.body){const y=s.body.getReader(),T=await y.read();await y.cancel()}return console.log("è¿žæŽ¥é¢„çƒ­æˆåŠŸï¼ŒçŠ¶æ€ç :",s.status),f.value=!1,!0}}catch(s){if(clearTimeout(n),s.name==="AbortError")return console.warn("è¿žæŽ¥é¢„çƒ­è¶…æ—¶"),f.value=!1,!0;console.warn("Rangeè¯·æ±‚å¤±è´¥ï¼Œå°è¯•HEADè¯·æ±‚:",s.message);const y=new AbortController,T=setTimeout(()=>y.abort(),1e4);try{const w=await fetch(e,{method:"HEAD",mode:"cors",cache:"no-cache",signal:y.signal});return clearTimeout(T),console.log("HEADè¯·æ±‚é¢„çƒ­æˆåŠŸï¼ŒçŠ¶æ€ç :",w.status),f.value=!1,!0}catch(w){clearTimeout(T),w.name==="AbortError"?console.warn("HEADè¯·æ±‚è¶…æ—¶"):console.warn("HEADè¯·æ±‚ä¹Ÿå¤±è´¥:",w.message)}}return console.warn("è¿žæŽ¥é¢„çƒ­å¤±è´¥ï¼Œä½†å°†ç»§ç»­å°è¯•æ’­æ”¾"),f.value=!1,!0}catch(o){return console.warn("è¿žæŽ¥é¢„çƒ­è¿‡ç¨‹å‡ºé”™:",o.message),f.value=!1,!0}},k=()=>{if(!r.value)return;const e=r.value;let n=e.parentElement?.clientWidth||0,s=9/16*n;s>e.clientHeight&&(s=e.clientHeight,n=16/9*s),n>0&&s>0&&(e.style.width=n+"px",e.style.height=s+"px",e.style.paddingTop="0")},P=()=>{if(!r.value)return;const e={container:r.value,autoWasm:!0,background:"",controlAutoHide:!1,debug:!1,decoder:"/jessibuca/decoder.js",forceNoOffscreen:!1,hasAudio:h.hasAudio,heartTimeout:15,heartTimeoutReplay:!0,heartTimeoutReplayTimes:5,hiddenAutoPause:!1,hotKey:!0,isFlv:!1,isFullResize:!1,isNotMute:b.value,isResize:!1,keepScreenOn:!0,loadingText:"è§†é¢‘åŠ è½½ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...",loadingTimeout:30,loadingTimeoutReplay:!0,loadingTimeoutReplayTimes:5,openWebglAlignment:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1,record:!1},recordType:"mp4",rotate:0,showBandwidth:!1,supportDblclickFullscreen:!1,timeout:30,useMSE:!0,useWCS:!1,useWebFullScreen:!0,videoBuffer:.5,wasmDecodeErrorReplay:!0,wcsUseVideoRender:!0};console.log("Jessibuca -> options: ",e),typeof window<"u"&&window.Jessibuca?(t=new window.Jessibuca(e),H()):console.error("Jessibuca not available")};let i=0,v="";const H=()=>{t&&(t.on("pause",()=>{d.value=!1,p("pause")}),t.on("play",()=>{d.value=!0,D.value=!0,i=0,p("play")}),t.on("fullscreen",e=>{g.value=e,p("fullscreen",e)}),t.on("mute",e=>{b.value=!e}),t.on("performance",e=>{let o="å¡é¡¿";e===2?o="éžå¸¸æµç•…":e===1&&(o="æµç•…"),F.value=o}),t.on("kBps",e=>{C.value=Math.round(e)}),t.on("error",async e=>{console.log("Jessibuca -> error: ",e);const o=e.toLowerCase();if((e.indexOf("CERT")!==-1||o.indexOf("certificate")!==-1||e.indexOf("ERR_CERT")!==-1||o.indexOf("fetcherror")!==-1||o.indexOf("common_name")!==-1||o.indexOf("common name")!==-1)&&i<Y&&v){if(i++,console.log(`æ£€æµ‹åˆ°è¯ä¹¦/è¿žæŽ¥é”™è¯¯ï¼Œè¿›è¡Œç¬¬${i}æ¬¡é‡è¯•...`),await x(v),await new Promise(s=>setTimeout(s,1500)),t)try{t.play(v)}catch(s){console.error("é‡è¯•æ’­æ”¾å¤±è´¥:",s),i=0,p("error",e)}}else i=0,p("error",e)}),t.on("timeout",e=>{console.log("Jessibuca -> timeout: ",e)}),t.on("loadingTimeout",e=>{console.log("Jessibuca -> loadingTimeout: ",e)}))},R=async()=>{await _(h.videoUrl)},_=async e=>{if(console.log("Jessibuca -> url: ",e),!e){console.log("è§†é¢‘URLä¸ºç©ºï¼Œè·³è¿‡æ’­æ”¾");return}v=e,i=0,console.log("å¼€å§‹è¿žæŽ¥é¢„çƒ­..."),await x(e),await new Promise(o=>setTimeout(o,500)),t&&A(),P(),t&&setTimeout(()=>{t&&t.hasLoaded()?(console.log("æ’­æ”¾å™¨å·²åŠ è½½ï¼Œå¼€å§‹æ’­æ”¾"),t.play(e)):t&&t.on("load",()=>{console.log("æ’­æ”¾å™¨åŠ è½½å®Œæˆï¼Œå¼€å§‹æ’­æ”¾"),t.play(e)})},1500)},O=()=>{t&&t.pause(),d.value=!1},A=()=>{t&&t.destroy();const e=document.getElementById("buttonsBox");e&&r.value&&r.value.appendChild(e),t=null,d.value=!1},z=()=>{t&&t.screenshot()},M=()=>{t&&t.mute()},V=()=>{t&&t.cancelMute()},E=()=>{const e=W();t&&t.setFullscreen(!e),g.value=!e},W=()=>!!(document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement);return L(()=>h.videoUrl,async e=>{e&&setTimeout(async()=>{await _(e)},3e3)},{immediate:!0}),U(()=>{if(k(),window.addEventListener("resize",k),typeof window<"u"&&!window.Jessibuca){const e=document.createElement("script");e.src="/jessibuca/jessibuca.js",e.onload=()=>{console.log("Jessibuca loaded successfully")},document.head.appendChild(e)}}),N(()=>{t&&t.destroy(),window.removeEventListener("resize",k)}),(e,o)=>(u(),c("div",{class:"video-player-container",style:I({height:J.value})},[l("div",{ref_key:"container",ref:r,onDblclick:E,style:{width:"100%",height:"100%","background-color":"#000000",margin:"0 auto",position:"relative"}},[o[2]||(o[2]=l("div",{style:{width:"100%","padding-top":"56.25%",position:"relative"}},null,-1)),l("div",G,[l("div",q,[d.value?m("",!0):(u(),c("i",{key:0,class:"play-btn",onClick:R},"â–¶")),d.value?(u(),c("i",{key:1,class:"pause-btn",onClick:O},"â¸")):m("",!0),l("i",{class:"stop-btn",onClick:A},"â¹"),b.value?(u(),c("i",{key:2,class:"audio-btn",onClick:o[0]||(o[0]=n=>M())},"ðŸ”Š")):m("",!0),b.value?m("",!0):(u(),c("i",{key:3,class:"mute-btn",onClick:o[1]||(o[1]=n=>V())},"ðŸ”‡"))]),l("div",Q,[l("span",X,$(C.value)+" kb/s",1),l("i",{class:"screenshot-btn",onClick:z},"ðŸ“·"),l("i",{class:"refresh-btn",onClick:R},"ðŸ”„"),g.value?m("",!0):(u(),c("i",{key:0,class:"fullscreen-btn",onClick:E},"â›¶")),g.value?(u(),c("i",{key:1,class:"exit-fullscreen-btn",onClick:E},"â›¶")):m("",!0)])])],544)],4))}}),te=K(Z,[["__scopeId","data-v-6e44ac6a"]]);export{te as V};
