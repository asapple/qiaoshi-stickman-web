import{d as B,r as f,o as F,c as m,a,b as i,w as l,u as t,N as j,P as A,T as $,s as I,e as c,f as L,I as _,g as x,F as O,h as G,L as U,i as d,B as h,j as D,k as y,l as q,m as E,n as p,p as J,q as M,t as T,_ as R}from"./index-BVl6wHkf.js";import{G as H,a as K}from"./index-C3n9xJCv.js";const Q={class:"device-page"},W={class:"content"},X={class:"device-card"},Y={class:"device-name"},Z={class:"device-status"},ee={key:0,class:"loading-placeholder"},se={key:1,class:"empty-placeholder"},te={class:"add-device-popup"},ae={class:"popup-content"},oe={class:"popup-footer"},ne=B({__name:"DeviceView",setup(le){const C=E(),w=f([]),v=f(!1),u=f(!1),n=f({deviceId:"",devicePassword:""}),k=()=>localStorage.getItem("authToken")||"",g=async()=>{v.value=!0,I("加载中...");try{const o=k(),s=await(await fetch("https://121.40.120.244/stickman/box/list_all_boxes_of_user",{method:"POST",headers:{Authorization:o,"Content-Type":"application/json"}})).json();s.code===200?w.value=s.data.map(r=>({id:r.id,name:r.boxName||`设备 ${r.boxDeviceId}`,status:r.turnOn?"online":"offline",boxDeviceId:r.boxDeviceId})):c(s.message||"获取设备列表失败")}catch(o){c("网络错误"),console.error("Failed to fetch devices:",o)}finally{v.value=!1,L()}},P=o=>{C.push(`/device/${o}`)},b=()=>{u.value=!0},V=async()=>{if(!n.value.deviceId){c("请输入设备ID");return}if(!n.value.devicePassword){c("请输入设备密码");return}try{I("绑定中...");const o=k(),s=await(await fetch("https://121.40.120.244/stickman/user/box/add",{method:"POST",headers:{Authorization:o,"Content-Type":"application/json"},body:JSON.stringify({boxDeviceId:n.value.deviceId,password:n.value.devicePassword})})).json();s.code===200?(q("设备绑定成功"),n.value.deviceId="",n.value.devicePassword="",u.value=!1,await g()):c(s.message||"绑定失败")}catch(o){c("网络错误，请稍后重试"),console.error("Failed to add device:",o)}},S=()=>{n.value.deviceId="",n.value.devicePassword="",u.value=!1},z=o=>{switch(o){case"online":return"#07c160";case"offline":return"#c8c9cc";case"maintenance":return"#ff976a";default:return"#c8c9cc"}},N=o=>{switch(o){case"online":return"在线";case"offline":return"离线";case"maintenance":return"维护中";default:return"未知"}};return F(()=>{g()}),(o,e)=>(p(),m("div",Q,[a(t(j),{title:"设备管理"},{right:l(()=>[a(t(_),{name:"replay",size:"20",onClick:g,style:{"margin-right":"15px"}}),a(t(_),{name:"plus",size:"20",onClick:b})]),_:1}),i("div",W,[a(t(H),{"column-num":2,border:!1,gutter:"10"},{default:l(()=>[(p(!0),m(O,null,G(w.value,s=>(p(),J(t(K),{key:s.id,onClick:r=>P(s.id)},{default:l(()=>[i("div",X,[i("div",{class:"status-indicator",style:M({backgroundColor:z(s.status)})},null,4),a(t(_),{name:"graphic",size:"32"}),i("div",Y,T(s.name),1),i("div",Z,T(N(s.status)),1)])]),_:2},1032,["onClick"]))),128)),v.value?(p(),m("div",ee,[a(t(U),{size:"24px"},{default:l(()=>e[3]||(e[3]=[d("加载中...",-1)])),_:1,__:[3]})])):x("",!0),!v.value&&w.value.length===0?(p(),m("div",se,[a(t(_),{name:"info-o",size:"48"}),e[5]||(e[5]=i("p",null,"暂无设备",-1)),a(t(h),{round:"",onClick:b},{default:l(()=>e[4]||(e[4]=[d("添加设备",-1)])),_:1,__:[4]})])):x("",!0)]),_:1})]),a(t(A),{show:u.value,"onUpdate:show":e[2]||(e[2]=s=>u.value=s),position:"bottom",style:{height:"40%"},round:""},{default:l(()=>[i("div",te,[e[8]||(e[8]=i("div",{class:"popup-header"},[i("h2",null,"添加新设备")],-1)),i("div",ae,[a(t(D),{modelValue:n.value.deviceId,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.deviceId=s),label:"设备ID",placeholder:"请输入设备ID",clearable:""},null,8,["modelValue"]),a(t(D),{modelValue:n.value.devicePassword,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.devicePassword=s),type:"password",label:"设备密码",placeholder:"请输入设备密码",clearable:""},null,8,["modelValue"])]),i("div",oe,[a(t(h),{block:"",round:"",onClick:S,style:{margin:"0 10px 10px 10px"}},{default:l(()=>e[6]||(e[6]=[d(" 取消 ",-1)])),_:1,__:[6]}),a(t(h),{type:"primary",block:"",round:"",onClick:V,style:{margin:"0 10px 10px 10px"}},{default:l(()=>e[7]||(e[7]=[d(" 确认 ",-1)])),_:1,__:[7]})])])]),_:1},8,["show"]),a(t($),{route:""},{default:l(()=>[a(t(y),{replace:"",to:"/device",icon:"apps-o"},{default:l(()=>e[9]||(e[9]=[d("设备",-1)])),_:1,__:[9]}),a(t(y),{replace:"",to:"/contacts",icon:"contact-o"},{default:l(()=>e[10]||(e[10]=[d("通知人",-1)])),_:1,__:[10]}),a(t(y),{replace:"",to:"/profile",icon:"user-o"},{default:l(()=>e[11]||(e[11]=[d("我的",-1)])),_:1,__:[11]})]),_:1})]))}}),re=R(ne,[["__scopeId","data-v-81ee3fba"]]);export{re as default};
